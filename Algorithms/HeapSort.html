<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeapSorting</title>
    <style> body {padding: 0; margin: 0;} </style>
    <script src="../p5.min.js"></script>
    <script src="../addons/p5.dom.min.js"></script>
    <script src="../addons/p5.sound.min.js"></script>
    <script type="text/javascript">
    var numbers = [];
    var FirstTimei = 0;
    var i = 0;
    function setup() {
	  //random elements
	  numbers = new Array(windowWidth);
	  for (let i = 0; i < numbers.length; i++) {
	    numbers[i] = random(windowHeight);
	  }
	  i = numbers.length - 1;
	  heapify(numbers, numbers.length); //1st step of heapsort
	  frameRate(60);
	  createCanvas(windowWidth, windowHeight-5);
	}

    //Heap sort	
    
	function draw() {
	  var sizeOfLine = (windowWidth)/numbers.length; 
	  background(0);
	  stroke(220,200 ,50);
	  strokeWeight(sizeOfLine);
	  	if(i > 0)
		{console.log(i);
			swap(numbers , i , 0);
			max_heapify(numbers , 0 , i-1);
			i--;
		}
		else
		{
			console.log("finished");
			noLoop();
		}
	  for(var x = 0 ; x < numbers.length ; x++)
	  { 
	  		//** recolor based on percentage of maximum value
	  	 if( (0 <= numbers[x]) && (numbers[x] <= (windowHeight * 0.33)) )
	  	 {
	  	 	stroke(6 , 229, 50);
	  	 }
	  	 else if ((numbers[x] >= (windowHeight * 0.33)) && (numbers[x] <= (windowHeight * 0.66)))
	  	 {
	  	 	stroke(210 ,208 ,50);
	  	 }
	  	 else
	  	 {
	  	 	stroke(191 ,1 ,50);
	  	 }
	  	line((x * sizeOfLine) ,height ,(x * sizeOfLine) ,height - numbers[x]);
	  }
	}

	function swap(array , i ,j)
	{
		var temp = array[i];
		array[i] = array[j];
		array[j] = temp;
	}

	function max_heapify(a, i, length) {
    while (true) {
        var left = i*2 + 1;
        var right = i*2 + 2;
        var largest = i;

        if (left < length && a[left] > a[largest]) {
            largest = left;
        }

        if (right < length && a[right] > a[largest]) {
            largest = right;
        }

        if (i == largest) {
            break;
        }

        swap(a, i, largest);
        i = largest;
    }
}

	function heapify(a, length) {
	    for (var i = Math.floor(length/2); i >= 0; i--) {
	        max_heapify(a, i, length);
	    }
	}

    </script>
  </head>
  <body>

  </body>
</html>
